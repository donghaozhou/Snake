"use strict";const CVS=document.getElementById("cvs"),CTX=CVS.getContext("2d");function Game(){this.xy=25,this.dir="right",this.tail=5,this.score=0,this.grow=!1,this.speed=200,this.food={x:null,y:null,eat:!0}}CTX.scale(20,20);const GAME=new Game,TAB=new Array;function draw(e,t){let o=TAB.getMinXY(),r=TAB.getMaxXY();0!==GAME.score&&GAME.score%500==0&&!0===GAME.grow?TAB[o.y][o.x]=0:TAB[o.y][o.x]="null",GAME.grow=!1,r.y+t<=24&&r.x+e<=24&&r.y+t>=0&&r.x+e>=0?TAB[r.y+t][r.x+e]=r.max+1:r.y+t>24?(r.y=-1,TAB[r.y+t][r.x+e]=r.max+1):r.x+e>24?(r.x=-1,TAB[r.y+t][r.x+e]=r.max+1):r.y+t<0?(r.y=25,TAB[r.y+t][r.x+e]=r.max+1):r.x+e<0&&(r.x=25,TAB[r.y+t][r.x+e]=r.max+1),!0===GAME.food.eat&&(GAME.food.x=Math.floor(Math.random()*GAME.xy),GAME.food.y=Math.floor(Math.random()*GAME.xy),"string"==typeof TAB[GAME.food.y][GAME.food.x]?TAB[GAME.food.y][GAME.food.x]="food":(GAME.food.x=Math.floor(Math.random()*GAME.xy),GAME.food.y=Math.floor(Math.random()*GAME.xy),TAB[GAME.food.y][GAME.food.x]="food"),GAME.food.eat=!1),TAB[GAME.food.y][GAME.food.x]===TAB[r.y+t][r.x+e]&&(GAME.food.eat=!0,GAME.grow=!0,document.getElementById("score").innerHTML=GAME.score+=100),CTX.fillStyle="black",CTX.fillRect(0,0,CVS.width,CVS.height),TAB.forEach((e,t)=>{e.forEach((e,o)=>{"number"==typeof e?(CTX.fillStyle="red",CTX.fillRect(o,t,1,1)):"food"===e&&(CTX.fillStyle="green",CTX.fillRect(o,t,1,1))})})}TAB.createCvs=function(){for(let e=0;e<GAME.xy;e++)this.push(new Array(GAME.xy).fill("null"))},TAB.createSnake=function(){for(let e=0;e<GAME.tail;e++)this[0][e]=e},TAB.getMinXY=function(){let e=Math.min.apply(null,this.flat().filter(function(e){return"number"==typeof e}));for(let t=0;t<GAME.xy;t++)for(let o=0;o<GAME.xy;o++)if(this[t][o]===e)return{y:t,x:o}},TAB.getMaxXY=function(){let e=Math.max.apply(null,this.flat().filter(function(e){return"number"==typeof e}));for(let t=0;t<GAME.xy;t++)for(let o=0;o<GAME.xy;o++)if(this[t][o]===e)return{y:t,x:o,max:e}},TAB.createCvs(),TAB.createSnake(),draw(0,0);var speed=GAME.speed,add=GAME.speed;function timer(e){e>=add&&(add+=speed,"right"===GAME.dir&&draw(1,0),"left"===GAME.dir&&draw(-1,0),"top"===GAME.dir&&draw(0,-1),"bottom"===GAME.dir&&draw(0,1)),"visible"===document.visibilityState?requestAnimationFrame(timer):cancelAnimationFrame(timer)}timer();var pre=null;document.addEventListener("keydown",e=>{switch(e.keyCode){case 37:"right"!==pre&&(GAME.dir="left",pre=GAME.dir);break;case 38:"bottom"!==pre&&(GAME.dir="top",pre=GAME.dir);break;case 39:"left"!==pre&&(GAME.dir="right",pre=GAME.dir);break;case 40:"top"!==pre&&(GAME.dir="bottom",pre=GAME.dir)}}),window.onerror=function(){alert("你死了,您的最终得分是"+GAME.score+",请再接再厉!"),location.reload()};